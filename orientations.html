<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mandatory Volunteer Orientations - Open House 2026</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }

  .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

  .events-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }

  .event-card {
    display: grid; grid-template-columns: 160px 1fr auto; gap: 16px;
    background: #fff; border-radius: 12px; overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: box-shadow 0.2s;
    align-items: center; padding-right: 20px;
  }
  .event-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }

  .event-image { width: 160px; height: 120px; object-fit: cover; display: block; }

  .event-info { padding: 12px 0; }
  .event-title { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
  .event-address { font-size: 13px; color: #666; margin-bottom: 4px; }
  .event-time { font-size: 13px; color: #888; }
  .event-spots { font-size: 13px; color: #27ae60; font-weight: 500; margin-top: 4px; }
  .event-spots.full { color: #e74c3c; }

  .signup-btn {
    padding: 10px 20px; background: #27ae60; color: #fff; border: none;
    border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;
    text-decoration: none; white-space: nowrap; transition: background 0.2s;
  }
  .signup-btn:hover { background: #219a52; }

  .loading, .error, .no-events { text-align: center; padding: 40px 20px; color: #888; font-size: 16px; }
  .error { color: #e74c3c; }

  @media (max-width: 640px) {
    .event-card { grid-template-columns: 1fr; padding: 0 0 16px 0; }
    .event-image { width: 100%; height: 160px; }
    .event-info { padding: 0 16px; }
    .signup-btn { margin: 0 16px; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="events-grid" id="events">
    <div class="loading">Loading orientations...</div>
  </div>
</div>

<script>
const API_URL = 'https://pointapp-8f268.appspot.com/api/v1/shared/frames/events';
const TOKEN = 'de80b5a6-f24b-4f6f-8d64-e516ceb01691';
const EVENT_URL = 'https://dash.pointapp.org/events/';

function formatDate(ts, tz) {
  return new Date(ts).toLocaleDateString('en-US', {
    weekday: 'short', month: 'short', day: 'numeric', year: 'numeric', timeZone: tz
  });
}

function formatTime(startTs, endTs, tz) {
  const opts = { hour: 'numeric', minute: '2-digit', timeZone: tz };
  return new Date(startTs).toLocaleTimeString('en-US', opts)
    + ' \u2013 ' + new Date(endTs).toLocaleTimeString('en-US', opts);
}

function el(tag, className) {
  const e = document.createElement(tag);
  if (className) e.className = className;
  return e;
}

async function loadEvents() {
  const container = document.getElementById('events');
  try {
    const resp = await fetch(API_URL + '?token=' + TOKEN + '&page=1&size=100');
    if (!resp.ok) throw new Error('Failed to load events');
    const data = await resp.json();

    const orientations = data.items
      .filter(e => /orientation/i.test(e.title))
      .sort((a, b) => a.startTime - b.startTime);

    container.textContent = '';

    if (orientations.length === 0) {
      const msg = el('div', 'no-events');
      msg.textContent = 'No upcoming orientations found.';
      container.appendChild(msg);
      return;
    }

    orientations.forEach(event => {
      const card = el('div', 'event-card');

      const img = el('img', 'event-image');
      img.src = event.image;
      img.alt = '';
      img.loading = 'lazy';
      card.appendChild(img);

      const info = el('div', 'event-info');

      const title = el('div', 'event-title');
      title.textContent = event.title;
      info.appendChild(title);

      const address = el('div', 'event-address');
      address.textContent = event.address;
      info.appendChild(address);

      const time = el('div', 'event-time');
      time.textContent = formatDate(event.startTime, event.timezone)
        + ' \u00b7 ' + formatTime(event.startTime, event.endTime, event.timezone);
      info.appendChild(time);

      const spots = el('div', event.spotsFree === 0 ? 'event-spots full' : 'event-spots');
      spots.textContent = event.spotsFree === 0
        ? 'Full'
        : event.spotsFree + ' of ' + event.spots + ' spots available';
      info.appendChild(spots);

      card.appendChild(info);

      const link = el('a', 'signup-btn');
      link.textContent = 'Sign Up';
      link.href = EVENT_URL + event.id;
      link.target = '_blank';
      link.rel = 'noopener';
      card.appendChild(link);

      container.appendChild(card);
    });
  } catch (err) {
    container.textContent = '';
    const msg = el('div', 'error');
    msg.textContent = 'Unable to load orientations. Please try again later.';
    container.appendChild(msg);
  }
}

loadEvents();
</script>

</body>
</html>
