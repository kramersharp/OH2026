<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Open House 2026 - Volunteer Events</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }

  .container { max-width: 1000px; margin: 0 auto; padding: 20px; }

  .filters { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
  .filter-btn {
    padding: 8px 16px; border: 2px solid #ccc; border-radius: 24px;
    background: #fff; cursor: pointer; font-size: 14px; font-weight: 500;
    transition: all 0.2s;
  }
  .filter-btn:hover { border-color: #666; }
  .filter-btn.active { background: #2c3e50; color: #fff; border-color: #2c3e50; }

  .events-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }

  .event-card {
    display: grid; grid-template-columns: 160px 1fr auto; gap: 16px;
    background: #fff; border-radius: 12px; overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: box-shadow 0.2s;
    align-items: center; padding-right: 20px;
  }
  .event-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); }

  .event-image { width: 160px; height: 120px; object-fit: cover; display: block; }

  .event-info { padding: 12px 0; }
  .event-neighborhood {
    font-size: 11px; font-weight: 700; text-transform: uppercase;
    letter-spacing: 0.5px; color: #fff;
    padding: 2px 8px; border-radius: 4px; display: inline-block; margin-bottom: 6px;
  }
  .event-title { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
  .event-address { font-size: 13px; color: #666; margin-bottom: 4px; }
  .event-time { font-size: 13px; color: #888; }
  .event-spots { font-size: 13px; color: #27ae60; font-weight: 500; margin-top: 4px; }
  .event-spots.full { color: #e74c3c; }

  .signup-btn {
    padding: 10px 20px; background: #27ae60; color: #fff; border: none;
    border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;
    text-decoration: none; white-space: nowrap; transition: background 0.2s;
  }
  .signup-btn:hover { background: #219a52; }

  .loading, .error, .no-events { text-align: center; padding: 40px 20px; color: #888; font-size: 16px; }
  .error { color: #e74c3c; }

  .n-bankers-hill { background: #2c3e50; }
  .n-civic-center { background: #8e44ad; }
  .n-east-village { background: #e67e22; }
  .n-little-italy { background: #c0392b; }
  .n-north-park { background: #2980b9; }
  .n-other { background: #7f8c8d; }

  @media (max-width: 640px) {
    .event-card { grid-template-columns: 1fr; padding: 0 0 16px 0; }
    .event-image { width: 100%; height: 160px; }
    .event-info { padding: 0 16px; }
    .signup-btn { margin: 0 16px; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="filters" id="filters"></div>
  <div class="events-grid" id="events">
    <div class="loading">Loading events...</div>
  </div>
</div>

<script>
const API_URL = 'https://pointapp-8f268.appspot.com/api/v1/shared/frames/events';
const TOKEN = 'de80b5a6-f24b-4f6f-8d64-e516ceb01691';
const EVENT_URL = 'https://dash.pointapp.org/events/';

const NEIGHBORHOOD_COLORS = {
  'Bankers Hill': 'n-bankers-hill',
  'Civic Center': 'n-civic-center',
  'East Village': 'n-east-village',
  'Little Italy': 'n-little-italy',
  'North Park': 'n-north-park',
};

let allEvents = [];
let activeFilter = 'All';

function parseNeighborhood(title) {
  const match = title.match(/^(.+?):\s/);
  return match ? match[1] : 'Other';
}

function formatDate(ts, tz) {
  return new Date(ts).toLocaleDateString('en-US', {
    weekday: 'short', month: 'short', day: 'numeric', year: 'numeric', timeZone: tz
  });
}

function formatTime(startTs, endTs, tz) {
  const opts = { hour: 'numeric', minute: '2-digit', timeZone: tz };
  return new Date(startTs).toLocaleTimeString('en-US', opts)
    + ' \u2013 ' + new Date(endTs).toLocaleTimeString('en-US', opts);
}

function el(tag, className) {
  const e = document.createElement(tag);
  if (className) e.className = className;
  return e;
}

function renderFilters(events) {
  const counts = {};
  events.forEach(e => {
    const n = parseNeighborhood(e.title);
    counts[n] = (counts[n] || 0) + 1;
  });

  const filtersEl = document.getElementById('filters');
  filtersEl.textContent = '';
  const neighborhoods = ['All', ...Object.keys(counts).sort()];

  neighborhoods.forEach(n => {
    const count = n === 'All' ? events.length : counts[n];
    const btn = el('button', 'filter-btn' + (n === activeFilter ? ' active' : ''));
    btn.textContent = n + ' (' + count + ')';
    btn.addEventListener('click', function() {
      activeFilter = n;
      renderFilters(allEvents);
      renderEvents();
    });
    filtersEl.appendChild(btn);
  });
}

function renderEvents() {
  const container = document.getElementById('events');
  container.textContent = '';

  const filtered = activeFilter === 'All'
    ? allEvents
    : allEvents.filter(e => parseNeighborhood(e.title) === activeFilter);

  if (filtered.length === 0) {
    const msg = el('div', 'no-events');
    msg.textContent = 'No events found for this neighborhood.';
    container.appendChild(msg);
    return;
  }

  filtered.forEach(event => {
    const neighborhood = parseNeighborhood(event.title);
    const displayTitle = event.title.replace(/^.+?:\s/, '');
    const nClass = NEIGHBORHOOD_COLORS[neighborhood] || 'n-other';

    const card = el('div', 'event-card');

    const img = el('img', 'event-image');
    img.src = event.image;
    img.alt = '';
    img.loading = 'lazy';
    card.appendChild(img);

    const info = el('div', 'event-info');

    const badge = el('span', 'event-neighborhood ' + nClass);
    badge.textContent = neighborhood;
    info.appendChild(badge);

    const title = el('div', 'event-title');
    title.textContent = displayTitle;
    info.appendChild(title);

    const address = el('div', 'event-address');
    address.textContent = event.address;
    info.appendChild(address);

    const time = el('div', 'event-time');
    time.textContent = formatDate(event.startTime, event.timezone)
      + ' \u00b7 ' + formatTime(event.startTime, event.endTime, event.timezone);
    info.appendChild(time);

    const spots = el('div', event.spotsFree === 0 ? 'event-spots full' : 'event-spots');
    spots.textContent = event.spotsFree === 0
      ? 'Full'
      : event.spotsFree + ' of ' + event.spots + ' spots available';
    info.appendChild(spots);

    card.appendChild(info);

    const link = el('a', 'signup-btn');
    link.textContent = 'Sign Up';
    link.href = EVENT_URL + event.id;
    link.target = '_blank';
    link.rel = 'noopener';
    card.appendChild(link);

    container.appendChild(card);
  });
}

async function loadEvents() {
  try {
    const resp = await fetch(API_URL + '?token=' + TOKEN + '&page=1&size=100');
    if (!resp.ok) throw new Error('Failed to load events');
    const data = await resp.json();
    allEvents = data.items;
    renderFilters(allEvents);
    renderEvents();
  } catch (err) {
    const container = document.getElementById('events');
    container.textContent = '';
    const msg = el('div', 'error');
    msg.textContent = 'Unable to load events. Please try again later.';
    container.appendChild(msg);
  }
}

loadEvents();
</script>

</body>
</html>
